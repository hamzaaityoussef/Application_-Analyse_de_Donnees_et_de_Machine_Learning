{% extends 'base.html' %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <style>
        body {
            background-color: #001f3f;
            color: #ffffff;
        }
        h1, h3 {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Tableau de bord</h1>
        
        <!-- Dropdown for selecting datasets -->
        <div class="mb-4">
            <label for="dataset-select" class="form-label">Sélectionner un dataset</label>
            <select id="dataset-select" class="form-select">
                <option value="">Choisir un dataset</option>
                {% for dataset in datasets %}
                    <option value="{{ dataset.id }}">{{ dataset.name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Dropdown for selecting columns (dynamically updated) -->
        <div class="mb-4">
            <label for="column-select" class="form-label">Sélectionner une colonne</label>
            <select id="column-select" class="form-select" disabled>
                <option value="">Choisir une colonne</option>
            </select>
        </div>

        <!-- Section for showing the chart -->
        <div class="mb-4">
            <h3>Graphique</h3>
            <div id="chart-container">
                <!-- Chart will be rendered here -->
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Handle dataset selection
        $('#dataset-select').change(function() {
            var datasetId = $(this).val();
            if (datasetId) {
                // Make AJAX request to get columns for the selected dataset
                $.ajax({
                    url: "{% url 'get_columns' %}",
                    data: {
                        dataset_id: datasetId
                    },
                    success: function(response) {
                        if (response.columns) {
                            var columnSelect = $('#column-select');
                            columnSelect.empty();
                            columnSelect.append('<option value="">Choisir une colonne</option>');
                            response.columns.forEach(function(col) {
                                columnSelect.append('<option value="' + col + '">' + col + '</option>');
                            });
                            columnSelect.prop('disabled', false);  
                        }
                    },
                    error: function(xhr) {
                        console.error('Error:', xhr.responseText);
                    }
                });
            } else {
                $('#column-select').empty().prop('disabled', true);
            }
        });

        // Handle column selection to update chart
        $('#column-select').change(function() {
            var datasetId = $('#dataset-select').val();
            var column = $(this).val();
            if (datasetId && column) {
                // Update chart here (e.g., create a chart based on the column)
                // You can use a library like Chart.js or just an image placeholder for now
                $('#chart-container').html('<img src="ML2.png" alt="Chart">');
            }
        });
    </script>
</body>
{% endblock %}
