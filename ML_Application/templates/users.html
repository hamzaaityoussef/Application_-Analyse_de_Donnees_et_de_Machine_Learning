{% extends 'app/base.html' %}
{% block content %}

<!-- popup temporaire --> 
<style>
    .table-container, .table-container table {
    width: 130%;
}
.table-row {
    padding-bottom: 10px; /* Adjust the value as needed for more or less space */
}
.card1 {
margin-bottom: 30px;
border: none;
border-radius: 5px;
}

  .btn.btn-dark {
background-color: green; /* Dark background color */
color: #ffffff; /* White text color */
border-color: #384034; /* Dark border color */
}

.btn.btn-dark:active,
.btn.btn-dark:focus,
.btn.btn-dark:active:focus {
background-color: #23ad3a !important; /* Retain dark background color */
color: #ffffff !important; /* Retain white text color */
border-color: #343a40 !important; /* Retain dark border color */
box-shadow: none; /* Remove any box shadow */
outline: none; /* Remove any outline */
}

</style>


<h1 class="mb-4  text-5xl">Gestion des <b> Utilisateurs</b></h1>
                <div class="border-t-4 border-t-indigo-500 border-transparent ...">
                    <br><br>
                </div>
<br>
<div class="container ">
    <div class="table-wrapper">
        


       
        
            
            <div class="card-header bg-white">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <!-- filter -->
                    <div class="row w-full mt-7">
                        <div class="col-12">
                            <div class="container">
                                <form method="get">
                                    <div class="form-row align-items-center">
                                        <div class="form-group col-12 col-sm-6 col-md-2">
                                            <input type="text" class="form-control form-control-sm" name="nom" placeholder="Nom">
                                        </div>
                                        <div class="form-group col-12 col-sm-6 col-md-2">
                                            <input type="text" class="form-control form-control-sm" name="prenom" placeholder="Prénom">
                                        </div>
                                        <div class="form-group col-12 col-sm-6 col-md-2">
                                            <input type="text" class="form-control form-control-sm" name="username" placeholder="Username">
                                        </div>
                                        <div class="form-group col-12 col-sm-6 col-md-2">
                                            <select class="form-control1 form-control-sm form-select1" name="Role" id="Role">
                                                <option value="">Select Role</option>
                                                {% for role in roles %}
                                                    <option value="{{ role }}">{{ role }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <!-- <div class="form-group col-12 col-sm-6 col-md-2">
                                            <select class="form-control1 form-control-sm form-select1" name="id_entity">
                                                <option value="">Select Entity</option>
                                                {% for id_entity, nom_entity in entities %}
                                                    <option value="{{ id_entity }}">{{ nom_entity }}</option>
                                                {% endfor %}
                                            </select>
                                        </div> -->
                                        <div class="form-group col-12 col-sm-6 col-md-2">
                                            <button class="btn btn-primary btn-sm " type="submit">Rechercher</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- end filter -->



                
                </div>
                <!-- Buttons -->
                <div class="card-header bg-white d-flex align-items-center justify-content-end">
                  
                
                    <a href="#addEmployeeModal" class="btn btn-dark mr-3" data-toggle="modal">
                        <i class="fas fa-user-plus"></i> <span>Add User</span>
                    </a>
                    <button class="btn btn-danger" id="deleteSelected" data-toggle="modal" data-target="#deleteConfirmationModal">
                        <i class="fas fa-trash-alt"></i> <span>Delete Users</span>
                    </button>
                </div>
                
                
            </div>
           <!-- =================================================== -->

            <!-- table  -->
            <div class="table-container">
                <table class="min-w-full bg-white shadow-md rounded-lg " >
                    <thead>
                        <tr class="bg-gray-100 text-gray-700 uppercase leading-normal font-bold">
                            <th class="py-4 px-6 text-left text-xl searchable">Select</th>
                            <th class="py-4 px-6 text-left text-xl searchable">ID Utilisateur</th>
                            <th class="py-4 px-6 text-left text-xl searchable">Nom</th>
                            <th class="py-4 px-6 text-left text-xl searchable">Prénom</th>
                            <th class="py-4 px-6 text-left text-xl searchable">Rôle</th>
                            <th class="py-4 px-6 text-left text-xl searchable">Username</th>
                            <th class="py-4 px-6 text-left text-xl searchable">Password</th>

                            <th class="py-4 px-6 text-left text-xl searchable">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-700">
                        <!-- {% for user in users %} -->
                        <tr class="border-b border-gray-200 hover:bg-gray-50">
                            <td class="py-4 px-6 text-2xl  ">
                                {% if authenticated_user != 'senior' and user.Role != 'senior' %}
                                <input type="checkbox" name="options[]" value="{{ user.id_user }}" >
                                {% endif %}
                                {% if authenticated_user == 'senior' %}
                                <input type="checkbox" name="options[]" value="{{ user.id_user }}" >
                                {% endif %}
                                
                            </td>
                            <td class="py-4 px-6 text-2xl">
                                <h6 class="mb-0">{{ user.id_user }}</h6>
                            </td>
                            <td class="py-4 px-6 text-2xl">
                                <h6 class="mb-0">{{ user.nom }}</h6>
                            </td>
                            <td class="py-4 px-6 text-2xl">
                                <h6 class="mb-0">{{ user.prenom }}</h6>
                            </td>
                            <td class="py-4 px-6 text-2xl">
                                <h6 class="mb-0">{{ user.Role }}</h6>
                            </td>
                            <td class="py-4 px-6 text-2xl">
                                {% if authenticated_user != 'senior' and user.Role != 'senior' %}
                                <h6 class="mb-0">{{ user.username }}</h6>
                                {% endif %}
                                {% if authenticated_user == 'senior'  %}
                                <h6 class="mb-0" >{{ user.username }}</h6>
                                {% endif %}
                                    
                            </td>
                            <td class="py-4 px-6 text-2xl">
                                
                                {% if authenticated_user != 'senior' and user.Role != 'senior' %}
                                <h6 class="mb-0">{{ user.password }}</h6>
                                {% endif %}
                                {% if authenticated_user == 'senior'  %}
                                <h6 class="mb-0" >{{ user.password }}</h6>
                                {% endif %}
                                
                            </td>
                            
                            <td > 
                                {% if authenticated_user != 'senior' and user.Role != 'senior' %}
                                <a href="#editEmployeeModal" onclick="getUser(this)" class="edit"  data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit" >&#xE254;</i></a>
                                <a href="#deleteEmployeeModal" class="delete" data-toggle="modal" data-userid="{{ user.id_user }}"><i class="material-icons" data-toggle="tooltip" title="Delete" >&#xE872;</i></a>
                                {% endif %}

                                {% if authenticated_user == 'senior' %}
                                <a href="#editEmployeeModal" onclick="getUser(this)" class="edit"  data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit" >&#xE254;</i></a>
                                <a href="#deleteEmployeeModal" class="delete" data-toggle="modal" data-userid="{{ user.id_user }}"><i class="material-icons" data-toggle="tooltip" title="Delete" >&#xE872;</i></a>
                                {% endif %}
                            </td>
                        </tr>
                        <!-- {% endfor %} -->
                    </tbody>
                </table>
            </div>
        
        



    <br>
<br>
 

<!-- pagination -->
<div class="clearfix"> 
    <div class="d-flex justify-content-between align-items-center mt-2"> 
        <!-- Align this div to the far left -->
        <div class="hint-text">Showing <b>{{ users.start_index }}</b> to <b>{{ users.end_index }}</b> of <b>{{ users.paginator.count }}</b> entries</div> 
        
        <!-- Align this ul to the center -->
        <ul class="pagination mb-0 custom-pagination" id="pagination" style="margin: 0 auto;"> 
            <!-- Pagination links will be dynamically generated here -->
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 rounded-l-lg bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">Previous</a>
            </li>
            <li class="page-item active">
                <a class="page-link text-xl px-3 py-2 bg-blue-600 text-white rounded" href="#">1</a>
            </li>
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">2</a>
            </li>
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">3</a>
            </li>
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 rounded-r-lg bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">Next</a>
            </li>
        </ul> 

        <form id="columnsForm" method="get" class="d-flex align-items-center ml-3 mt-7"> 
            {% for key, value in request.GET.items %} 
                {% if key != 'columns' %} 
                    <input type="hidden" name="{{ key }}" value="{{ value }}"> 
                {% endif %} 
            {% endfor %} 
            <select class="form-select  h-12 text-xl px-3 py-2" name="columns" id="columns" style=" width:  200px ;" onchange="changeColumnsPerPage()"> 
                <option value="" id="defaultOption" class="text-xl px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider">{{ columns }} éléments par page </option> 
                <option value="2" {% if columns == 2 %} selected {% endif %}>2</option> 
                <option value="4" {% if columns == 4 %} selected {% endif %}>4</option> 
                <option value="10" {% if columns == 10 %} selected {% endif %}>10</option> 
                <option value="50" {% if columns == 50 %} selected {% endif %}>50</option> 
                <option value="100" {% if columns == 100 %} selected {% endif %}>100</option> 
                <option value="1000" {% if columns == 1000 %} selected {% endif %}>1000</option> 
                <option value="{{ users.paginator.count }}" {% if columns == users.paginator.count %} selected {% endif %}>all</option>

                
            </select> 
        </form> 
    </div> 
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const totalPages = parseInt("{{ users.paginator.num_pages|default:0 }}");
        const currentPage = parseInt("{{ users.number|default:1 }}");
        const columnsPerPage = parseInt("{{ columns|default:10 }}");
        const urlParams = new URLSearchParams(window.location.search);

        function createPageLink(page, text, isActive = false) {
            const li = document.createElement('li');
            li.className = `page-item custom-page-item ${isActive ? 'active' : ''}`;
            const a = document.createElement('a');
            a.className = 'page-link custom-page-link';
            a.href = `?${urlParams.toString()}&page=${page}&columns=${columnsPerPage}`;
            a.textContent = text;
            li.appendChild(a);
            return li;
        }

        function updatePagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            

            if (currentPage > 4 ) {
                if (currentPage != 5){
                pagination.appendChild(createPageLink(1, '1'));
                pagination.appendChild(createPageLink(2, '2'));
               
                pagination.appendChild(createPageLink(3, '...'));
            }
            }
            if (currentPage == 5) {
                pagination.appendChild(createPageLink(1, '1'));
                pagination.appendChild(createPageLink(2, '2'));
                // pagination.appendChild(createPageLink(3, '3'));
                // pagination.appendChild(createPageLink(4, '4'));
                pagination.appendChild(createPageLink(5, '...'));
            }
            if (currentPage == 4) {
                pagination.appendChild(createPageLink(1, '1'));
               
            }
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                pagination.appendChild(createPageLink(i, i, i === currentPage));
            }

            if (currentPage < totalPages - 3) {
                pagination.appendChild(createPageLink(totalPages - 2, '...'));
                
                pagination.appendChild(createPageLink(totalPages - 1, totalPages - 1));
                pagination.appendChild(createPageLink(totalPages, totalPages));
            }

           
        }

        updatePagination();
    }); 
</script>
<script>
    function changeColumnsPerPage() {
        var select = document.getElementById("columns");
        var selectedOption = select.options[select.selectedIndex].value;
        var defaultOption = document.getElementById("defaultOption");
        defaultOption.textContent = select.options[select.selectedIndex].textContent;
        // Mettre à jour la valeur de la colonne dans la session
        fetch('?columns=' + selectedOption, { method: 'GET' });
        // Soumettre le formulaire lorsque la sélection change
        document.getElementById("columnsForm").submit();
    }
</script>




    <!-- Modals -->
    <!-- add user -->
    <div id="addEmployeeModal" class="modal fade" data-backdrop="static" data-keyboard="false">

        <div class="modal-dialog" >
            <div class="modal-content">
                <form method="post" action="">
                    {% csrf_token %}
                    <div class="modal-header justify-content-between">            
                        <h4 class="modal-title mr-96">Add Users</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">          
                        <div class="form-group">
                            <label for="nom">Nom</label>
                            {{ form.nom }}
                        </div>
                        <div class="form-group">
                            <label for="prenom">Prénom</label>
                            {{ form.prenom }}
                        </div>
                        <div class="form-group">
                            <label for="username">Username</label>
                            {{ form.username }}
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            {{ form.password }}
                        </div>
                        
                        <div class="form-group" >
                            <label for="Role">Role</label>
                           
                            {{ form.Role }}
                            
                        </div>
                        <div class="form-group" >
                            <label for="chat_id">Chat ID</label>
                           
                            {{ form.chat_id }}
                            
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                        <input type="submit" class="btn btn-success" value="Add">
                    </div>
                </form>
            </div>
        </div>
    </div>

	<!-- Edit user Modal HTML -->
    <div id="editEmployeeModal" class="modal fade" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="POST" action="{% url 'users1' user.id_user %}">
                    {% csrf_token %}
                    <div class="modal-header d-flex justify-content-between">						
                        <h4 class="modal-title mr-96">Modifier Utilisateur</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    
                    <div class="modal-body">					
                        <div class="form-group">
                            <label>Nom</label>
                            <input type="text" class="form-control" name="nom" required>
                        </div>
                        <div class="form-group">
                            <label>Prénom</label>
                            <input type="text" class="form-control" name="prenom" required>
                        </div>
                        <div class="form-group">
                            <label>Rôle</label>
                            <input type="text" class="form-control" name="Role" id="roleInput" {% if user.Role == 'manager' %}  {% endif %} required>
                        </div>
                    
                        
                        <div class="form-group">
                            <label>Nom d'utilisateur</label>
                            <input type="text" class="form-control" name="username" required>
                        </div>	
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="text" class="form-control" name="password" required>
                        </div>	
                       
                        
                        <!-- <div class="form-group">
                            <label>ID Entité</label>
                            <input type="text" {% if user.Role == 'manager' %}  {% endif %}   class="form-control" name="id_entity" required>
                        </div> -->

                        
                        <div class="container" id="entityCheckboxContainer" style="display: none;"> 
                            <label>Entity reserved</label> 
                            <div class="row"> 
                                {% for id_entity, nom_entity in entities %} 
                                    {% if id_entity != 1 and id_entity != 2 %} 
                                        <div class="col-md-4"> 
                                            <div class="form-check"> 
                                                <input class="form-check-input" type="checkbox" name="entity_checked" value="{{ id_entity }}" {% if id_entity in user_entity_checked %} checked {% endif %}> 
                                                <label class="form-check-label">{{ nom_entity }}</label> 
                                            </div> 
                                        </div> 
                                    {% endif %} 
                                {% endfor %} 
                            </div> 
                        </div>

                    </div>
                  
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn btn-info">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div> 
    





	<!-- Delete user Modal HTML -->
	<div id="deleteEmployeeModal" action="{% url 'delete_user' user.id_user %}" class="modal fade" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header d-flex justify-content-between">						
						<h4 class="modal-title mr-96">Delete Employee</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">					
						<p>Are you sure you want to delete these Records?</p>
						<p class="text-warning"><small>This action cannot be undone.</small></p>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<input type="submit" class="btn btn-danger" value="Delete">
					</div>
				</form>
			</div>
		</div>
	</div>


<!-- Modèle de confirmation de suppression user -->
<div id="deleteConfirmationModal" class="delete modal fade" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="deleteForm" method="get" action="{% url 'delete_selected' user.id_user %}">
                {% csrf_token %}
                <div class="modal-header d-flex justify-content-between">                        
                    <h4 class="modal-title mr-96">Delete Employee</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">                    
                    <p>Are you sure you want to delete these records?</p>
                    <p class="text-warning"><small>This action cannot be undone.</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>


</div>



	


<!-- delete entite  -->







<script>
// Function to toggle id_entity field based on selected role
function toggleEntityField() {
    var roleSelect = document.getElementById('id_Role');
    var entityField = document.getElementById('id_id_entity');

    if (roleSelect.value === 'user_support' || roleSelect.value === 'admin_support' || roleSelect.value === 'senior'  ) {
        entityField.value = '{{ form.admin_support_entity_id }}';  // Set value to admin_support's entity id
        entityField.disabled = true;
        entityField.parentElement.style.display = 'none';  // Hide field
    } else {
        entityField.disabled = false;
        entityField.parentElement.style.display = 'block';  // Show field
    }
}

// Call the function initially and whenever role changes
document.addEventListener('DOMContentLoaded', function () {
    toggleEntityField();  // Call initially
    document.getElementById('id_Role').addEventListener('change', toggleEntityField);  // Call whenever role changes
});
</script>


 <!-- error message for non check users  -->
<script>
    // Fonction pour vérifier si au moins un élément est sélectionné avant de supprimer
    function verifySelectionBeforeDelete() {
        // Récupérer tous les éléments checkbox
        var checkboxes = document.querySelectorAll('input[name="options[]"]');
        var isChecked = false;

        // Vérifier si au moins un élément est coché
        checkboxes.forEach(function(checkbox) {
            if (checkbox.checked) {
                isChecked = true;
            }
        });

        
        if (!isChecked) {
            alert("Please select at least one item to delete.");
            location.reload(); 
            return false; 
        }
        return true;
    }

    // Ajouter un gestionnaire d'événement click au bouton de suppression
    document.getElementById('deleteSelected').addEventListener('click', function(event) {
        // Empêcher le comportement par défaut (soumission du formulaire) si aucun élément n'est sélectionné
        if (!verifySelectionBeforeDelete()) {
            event.preventDefault();
        }
    });
</script>

<!-- hide select entity for user support  -->

<script>
    // Function to toggle visibility of Selected Entities section based on selected role
    function toggleSelectedEntitiesSection() {
        var roleSelect = document.getElementById('id_Role'); // Correction de l'identifiant
        var selectedEntitiesSection = document.getElementById('selectedEntitiesSection');
    
        if (roleSelect.value === 'user_support') {
            selectedEntitiesSection.style.display = 'block';  // Afficher la section pour le rôle user_support
        } else {
            selectedEntitiesSection.style.display = 'none';   // Cacher la section pour les autres rôles
        }
    }
    
    // Call the function initially and whenever role changes
    document.addEventListener('DOMContentLoaded', function () {
        toggleSelectedEntitiesSection();  // Call initially
        document.getElementById('id_Role').addEventListener('change', toggleSelectedEntitiesSection); // Correction de l'identifiant
    });
</script>


  <!-- hide select entity for user support  -->

  <script>
    // Function to toggle visibility of Selected Entities section based on selected role
    function toggleSelectedEntitiesSection() {
        var roleSelect = document.getElementById('id_Role'); // Correction de l'identifiant
        var selectedEntitiesSection = document.getElementById('selectedEntitiesSection');
    
        if (roleSelect.value === 'user_support') {
            selectedEntitiesSection.style.display = 'block';  // Afficher la section pour le rôle user_support
        } else {
            selectedEntitiesSection.style.display = 'none';   // Cacher la section pour les autres rôles
        }
    }
    
    // Call the function initially and whenever role changes
    document.addEventListener('DOMContentLoaded', function () {
        toggleSelectedEntitiesSection();  // Call initially
        document.getElementById('id_Role').addEventListener('change', toggleSelectedEntitiesSection); // Correction de l'identifiant
    });
</script>





<script>
function getUser(element) {
    var row = element.closest("tr"); // Get the closest table row
    var columns = row.getElementsByTagName("td"); // Get all td elements within that row
    
    // Extract user details from each column
    var id_user = columns[1].innerText;
    var nom = columns[2].innerText;
    var prenom = columns[3].innerText;
    var role = columns[4].innerText;
    var username = columns[5].innerText;
    var password = columns[6].innerText;
    // var id_entity = columns[7].innerText;
    // var entity_checked = columns[8].innerText;

    // Populate the form fields in the modal with the extracted details
    document.querySelector("#editEmployeeModal input[name='nom']").value = nom;
    document.querySelector("#editEmployeeModal input[name='prenom']").value = prenom;
    document.querySelector("#editEmployeeModal input[name='Role']").value = role;
    document.querySelector("#editEmployeeModal input[name='username']").value = username;
    document.querySelector("#editEmployeeModal input[name='password']").value = password;
    // document.querySelector("#editEmployeeModal input[name='id_entity']").value = id_entity;

    // Show or hide the entity checkboxes based on the role

    // var entityCheckboxContainer = document.querySelector("#entityCheckboxContainer");
    // if (role === 'user_support') {
    //     entityCheckboxContainer.style.display = 'block';

    //     // Check/uncheck checkboxes based on entity_checked
    //     var checkboxes = document.querySelectorAll("#editEmployeeModal input[name='entity_checked']");
    //     var checkedEntities = entity_checked.split(',').map(e => e.trim());

    //     checkboxes.forEach(function(checkbox) {
    //         if (checkedEntities.includes(checkbox.value)) {
    //             checkbox.checked = true;
    //         } else {
    //             checkbox.checked = false;
    //         }
    //     });
    // } else {
    //     entityCheckboxContainer.style.display = 'none';
    // }

    // Set the form action URL with the user id
    var form = document.querySelector("#editEmployeeModal form");
    form.action = "/edit_user/" + id_user + '/'; 
}


</script>

<script>
    
$(document).ready(function(){
    $('#deleteSelected').click(function(){
        var selectedItems = [];
        $('input[name="options[]"]:checked').each(function(){
            selectedItems.push($(this).val());
        });
        if(selectedItems.length > 0){
            $('#deleteConfirmationModal').modal('show');
            // Passer les ID des éléments sélectionnés au formulaire de suppression
            $('#deleteForm').append('<input type="hidden" name="selected_items" value="' + selectedItems.join(',') + '">');
        }
    });

    // Lorsque le formulaire de suppression est soumis
    $('#deleteForm').submit(function(e) {
        // Récupérer l'ID de l'utilisateur à partir de l'action du formulaire
        var action = $(this).attr('action');
        var id_user = action.split('/')[2];
        // Mettre à jour l'action du formulaire avec l'URL appropriée incluant l'ID de l'utilisateur
        $(this).attr("action", "/delete_selected/" + id_user + "/");
    });
});

document.addEventListener("DOMContentLoaded", function() {
    var deleteModal = document.getElementById("deleteEmployeeModal");
    var deleteForm = deleteModal.querySelector("form");

    // Add event listener to each delete link
    var deleteLinks = document.querySelectorAll(".delete");
    deleteLinks.forEach(function(link) {
        link.addEventListener("click", function() {
            var userId = this.dataset.userid;
            deleteForm.action = "/delete_user/" + userId + "/";
        });
    });
});


$(document).ready(function(){
    $('#deleteSelected').click(function(){
        var selectedItems = [];
        $('input[name="options[]"]:checked').each(function(){
            selectedItems.push($(this).val());
        });
        if(selectedItems.length > 0){
            $('#deleteConfirmationModal').modal('show');
            // Passer les ID des éléments sélectionnés au formulaire de suppression
            $('#deleteForm').append('<input type="hidden" name="selected_items" value="' + selectedItems.join(',') + '">');
        }
    });

    // Lorsque le formulaire de suppression est soumis
    $('#deleteForm').submit(function(e) {
        // Récupérer l'ID de l'utilisateur à partir de l'action du formulaire
        var action = $(this).attr('action');
        var id_user = action.split('/')[2];
        // Mettre à jour l'action du formulaire avec l'URL appropriée incluant l'ID de l'utilisateur
        $(this).attr("action", "/delete_selected/" + id_user + "/");
    });
});
</script>
{% endblock %}