{%extends 'app/base.html'%}

{% block content %}
<!-- created by hamza le 03/05/2024 -->


<!-- search in proxy filter  -->
<style>
    /* Remove border */
    .select2-container--default .select2-selection--single {
      display: block;
      /* width: 100%; */
      /* min-height: 34px; */
      padding-bottom: 28px;
      
      font-size: 1em;
      line-height: 1.5;
      color: #555;
      background-color: #fff;
      border: #95949454 0.5px solid;
      border-radius: 4px;
      padding-right: 2em; /* Adjust padding to accommodate arrow icon */
      
    }
    /* .select2-container--default{
      max-width: 39.5vw;
      
    } */
  /* Base styles for select2 container */
.select2-container--default {
    /* width: 100%; Full width by default */
    /* max-width: 100%; Override to control max width via JS */
    transition: width 0.3s ease; /* Smooth transition when resizing */
}

/* Responsive adjustments */
@media (max-width: 1024px) {
    .select2-container--default {
        max-width: 30vw; /* Max width for medium screens */
    }
}

@media (max-width: 768px) {
    .select2-container--default {
        max-width: 40vw; /* Max width for small screens */
    }
}

@media (max-width: 480px) {
    .select2-container--default {
        max-width: 60vw; /* Max width for very small screens */
    }
}

  </style>

<style>
    /* For the first column header */
/* Sticky header for the first column */
th.sticky-id-column {
    position: sticky;
    left: 0;
    background-color: white; /* Ensure background color stays white */
    z-index: 3; /* Higher z-index than the td cells */
    box-shadow: 2px 0 5px rgba(0,0,0,0.1); /* Optional: add some shadow for better visibility */
}

/* Sticky data cells for the first column */
td.sticky-id-column {
    position: sticky;
    left: 0;
    background-color: white;
    z-index: 1; /* Slightly lower z-index than the header */
    box-shadow: 2px 0 5px rgba(0,0,0,0.1); /* Optional: add shadow */
}


</style>


{% if selected_role in roles %}
<style>
    #tdtohaveminh>th {
        padding: 10px 4px !important;
    }
</style>
{% endif %}

{% if selected_role not in roles %}
<style>
    #tdtohaveminh>th {
        padding: 20px 10px !important;
    }
</style>
{% endif %}
 
<!-- ============================================== -->

<!-- <h1>{{output}}</h1> -->
<h1 class="mb-4 text-5xl px-6 py-3 text-left font-medium text-gray-700 uppercase tracking-wider">Gestion des seeds</h1>



<div class="border-t-4 border-t-indigo-500 border-transparent ...">
    <br><br>
</div>
<!-- divs in header  -->
<ul class="flex flex-wrap text-2xl font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400">
    <li class="me-2">
        <a href="#" aria-current="page" class="no-underline inline-block p-4 text-blue-600 bg-gray-100 rounded-t-lg active dark:bg-gray-800 dark:text-blue-500  active text-left font-medium  uppercase tracking-wider hover:no-underline" id="filterLink">Filter</a>
    </li>
    {% if selected_role in roles %}
    <li class="me-2">
        <a href="#" class=" no-underline inline-block p-4 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 dark:hover:text-gray-300 text-left font-medium text-gray-700 uppercase tracking-wider hover:no-underline" id="uploadLink">upload file</a>
    </li>
    {% endif %}
    <li class="me-2">
        <a href="#" class="inline-block p-4 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 dark:hover:text-gray-300 text-left font-medium text-gray-700 uppercase tracking-wider hover:no-underline no-underline" id="downloadLink">export data</a>
    </li>
    <li class="me-2">
        <a href="#" class="inline-block p-4 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 dark:hover:text-gray-300 text-left font-medium text-gray-700 uppercase tracking-wider hover:no-underline no-underline" id="specificdataLink">Specific data</a>
    </li>
    

</ul>


<div class="container mx-auto p-4 my-6">
    <div class="flex">

        <!-- Filter Section -->
        <div class="w-full max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg" id="filterDiv" style="display: none;">
            <div class="mb-6">
                <form method="get" action="" onsubmit="return submitForm()">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 ">
                    
                        
                        <!-- Proxy Selection -->
                        <div class="relative">
                            <select class="hamza w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="id_proxy" id="id_proxy">
                                <option value=""  selected>Select Proxy</option>
                                {% for proxy in all_proxies %}
                                <option value="{{ proxy }}" {% if proxy == id_proxy_query %}selected{% endif %}>{{ proxy }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- Status Selection -->
                        <div class="relative">
                            <select class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="statue_connect" id="statue_connect">
                                <option value="" selected>Select Status connect</option>
                                {% for statue in statue_connect_list %}
                                    <option value="{{ statue }}">{{ statue }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- Status 2FA -->
                        <div class="relative">
                            <select class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="statue_2FA" id="statue_2FA">
                                <option value=""  selected>Select Status 2FA</option> 
                                {% for statue in statue2fa_list %}
                                    <option value="{{ statue }}">{{ statue }}</option>
                                {% endfor %}
                            </select> 
                        </div>
                        <!-- Status backup -->
                        <div class="relative">
                            <select class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="statue_backup" id="statue_backup">
                                <option value="" selected>Select Status Backup</option>
                                {% for statue in statue_backup_list %}
                                    <option value="{{ statue }}">{{ statue }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Status password -->
                        <div class="relative">
                            <select class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="statue_change_password" id="statue_change_password">
                                <option value="" selected>Select Status Change Password</option>
                                {% for statue in statue_change_password_list %}
                                    <option value="{{ statue }}">{{ statue }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Status recovery -->
                        <div class="relative">
                            <select class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="statue_change_recovery" id="statue_change_recovery">
                                <option value="" selected>Select Status Change Recovery</option>
                                {% for statue in statue_change_recovery_list %}
                                    <option value="{{ statue }}">{{ statue }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Status recovery -->
                        <div class="relative">
                            <select class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="statue_change_recovery" id="statue_change_recovery">
                                <option value=""  selected>Select Status change recovery</option> 
                                <option value="RecoveryEmail Changed">RecoveryEmail Changed</option> 
                                <option value="RecoveryEmail Not Changed">RecoveryEmail Not Changed</option> 
                            </select> 
                        </div>

                        <!-- Date Range Inputs -->
                        <div class="col-span-2">
                            <div class="flex gap-4 ">
                                <input type="text" class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="date_action__gte" placeholder="Date Action From (YYYY-MM-DD)">
                                <input type="text" class="w-full h-12 px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="date_action__lte" placeholder="Date Action To (YYYY-MM-DD)">
                            </div>
                        </div>
                        
                        

                        <!-- Search Button -->
                        <div class="col-span-2 flex justify-center mt-4">
                            <button class="h-12 px-8 py-2 btn btn-primary btn-md ml-[50%]" type="submit">Search</button>
                        </div>
                    </div>
                    
                </form>
            </div>

            <!-- <div class="border-t-4 border-indigo-500 mb-6"></div> -->
        </div>


        <!-- export data  -->
        <div class="flex-none w-1/2 max-w-full px-3" id="downloadDiv" style="display: none;">
            <div class="border-t-2 border-t-indigo-500 border-transparent ...">
                <div class="p-6 pt-0 mt-0 bg-white rounded-lg">
                    <h1 class="mb-4 text-4xl px-6 py-3 text-left font-medium text-gray-700 uppercase tracking-wider mt-8"  >CHOOSE FILE TYPE :</h1> 
                    <div class="flex ml-3">
                        <form method="get" action="{% url 'export_table_data' %}" id="export_form">
                            <div class="ml-6 form-group col-md-12 flex">
                                <select id="file_type" name="file_type" class="form-control1 form-control-lg mr-4">
                                    <option value="csv">CSV</option>
                                    <option value="excel">Excel</option>
                                    <option value="text">Text</option>
                                </select>
                                <!-- <input type="hidden" name="id_entity" value="{{ request.GET.id_entity }}">
                                <input type="hidden" name="id_rdp" value="{{ request.GET.id_rdp }}">
                                <input type="hidden" name="id_sess" value="{{ request.GET.id_sess }}"> -->
                                <input type="hidden" name="id_proxy" value="{{ request.GET.id_proxy }}">
                                <input type="hidden" name="statue_connect" value="{{ request.GET.statue_connect }}">
                                <input type="hidden" name="statue_2FA" value="{{ request.GET.statue_2FA }}">
                                <input type="hidden" name="statue_backup" value="{{ request.GET.statue_backup }}">
                                <input type="hidden" name="statue_change_password" value="{{ request.GET.statue_change_password }}">
                                <input type="hidden" name="statue_change_recovery" value="{{ request.GET.statue_change_recovery }}">
                                <input type="hidden" name="date_action__gte" value="{{ request.GET.date_action__gte }}">
                                <input type="hidden" name="date_action__lte" value="{{ request.GET.date_action__lte }}">
                                <button type="submit" class="btn btn-primary export-button">Export</button>
                            </div>
                        </form>
                    </div>    
                </div>
            </div>
        </div>

        <!-- upload file  -->
        <div class="flex-none w-1/2 max-w-full px-3" id="uploadDiv"  style="display: none;">
            <div class="border-t-2 border-t-indigo-500 border-transparent ...">
                <hr> <hr><hr><hr><hr><hr><hr><hr><hr><hr>
                <div class="p-6 pt-0 mt-0 bg-white rounded-lg">
                    <h1 class="mb-4  text-4xl px-6 py-3 text-left font-medium text-gray-700 uppercase tracking-wider mt-4" {% if selected_role not in roles %} style="display: none;" {% endif %}>Upload files</h1> 
                    <!-- Right column for file upload -->
                    <div class="flex ml-3">
                        <form method="post" enctype="multipart/form-data" id="import" action="{% url 'upload_seeds' %}">
                            {% csrf_token %}
                            <div>
                               
                                {% if selected_role in roles %}
                                <!-- Right column for file upload -->
                                <div class="w-1/2 flex ml-3">
                                    <div class="-mt-4" class="block text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400" id="csv_file">
                                        {{ form.as_p }}
                                    </div>
                                    <div>
                                        <button type="submit" class="btn btn-primary mt-3">Upload</button>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </form>
                        
                            </div>
                </div>
            </div>
        </div>

        <div class="flex-none w-1/2 max-w-full px-3 border p-4 fixed-size bg-white shadow-md rounded" id="specificdataDiv" style="display: none;">
            <form method="get" action="{% url 'seeds' %}">
                <label for="specificIdsInput">Enter IDs,Emails or tags here, (one per line):</label>
                <textarea id="specificIdsInput" name="specific_ids" class="w-full h-12 px-4 py-2 border border-gray-300 rounded-lg" placeholder="Enter IDs,Emails or tags here, one per line"></textarea>
                <button type="submit" class="btn btn-primary mt-3">Filter</button>
            </form>
        </div>
        
        
    </div>
</div>
<!-- =================================================== -->




  <!-- Table Container -->
  <div class="table-container " >

    <table class="min-w-full bg-white shadow-md rounded-lg  " id="dataTable">
        <thead >
            <tr id="tdtohaveminh" class="bg-gray-100 text-gray-700 uppercase leading-normal font-bold " >
                
                
                <th class="sticky-id-column px-6 text-left text-xl searchable">
                    <div class="flex">
                        <span>id </span>
                        <button id="copy-seed-ids" onclick="copyColumnContent('seed-id')" class="copy-btn px-2 rounded shadow ml-8">
                            <i class="fa-regular fa-copy"></i>
                        </button>
                    </div>
                </th>
            
                <th class=" px-6 text-left text-xl searchable ">
                    <div class="flex">
                        <span>Tag</span>
                        <button id="copy-tags" onclick="copyColumnContent('tag')" class="copy-btn  px-2 rounded shadow ml-8">
                            <i class="fa-regular fa-copy"></i>
                        </button>
                    </div>
                </th>
                {% if selected_role in roles %}
                <th class=" px-6 text-left text-xl searchable">
                    <div class="flex">
                        <span>Email</span>
                        <button id="copy-emails" onclick="copyColumnContent('email')" class="copy-btn  px-2 rounded shadow ml-8">
                            <i class="fa-regular fa-copy"></i>
                        </button>
                    </div> 
                </th>
                <th class=" px-6 text-left text-xl searchable">Password</th>
                <th class=" px-6 text-left text-xl searchable">Recovery Email</th>
                <th class=" px-6 text-left text-xl searchable">New Password</th>
                <th class=" px-6 text-left text-xl searchable">New Recovery Email</th>
                {% endif %}
                <th class=" px-6 text-left text-xl searchable">Date Import</th>
                <th class=" px-6 text-left text-xl searchable">Date Action</th>
                <th class=" px-6 text-left text-xl searchable">Action</th>
                <th class=" px-6 text-left text-xl searchable">Status</th>
                <th class=" px-6 text-left text-xl searchable">Proxy</th>
            
                <th class=" px-6 text-left text-xl searchable">Statue connect</th>
                <th class=" px-6 text-left text-xl searchable">date connect</th>
                {% if selected_role in roles %}
                
                <th class=" px-6 text-left text-xl searchable">Statue change pass</th>
                <th class=" px-6 text-left text-xl searchable">date password</th>
            
                <th class=" px-6 text-left text-xl searchable">Statue change rec</th>
                <th class=" px-6 text-left text-xl searchable">date rec</th>
                
                <th class=" px-6 text-left text-xl searchable">Statue It Was Me</th>
                <th class=" px-6 text-left text-xl searchable">date action it was me</th>
                
                <th class=" px-6 text-left text-xl searchable">Statue delete device</th>
                <th class=" px-6 text-left text-xl searchable">date delete device</th>
                
                <th class=" px-6 text-left text-xl searchable">Statue delete phone</th>
                <th class=" px-6 text-left text-xl searchable">date delete phone</th>
                
                
                <th class=" px-6 text-left text-xl searchable">service phone</th>
                <th class=" px-6 text-left text-xl searchable">phone number</th>
                <!-- =================  17/09/2024 by hamza ait youssef   =================== -->
                <th class=" px-6 text-left text-xl searchable">Statue auth</th>
                <th class=" px-6 text-left text-xl searchable">date auth</th>
                
                <th class=" px-6 text-left text-xl searchable">Statue 2FA</th>
                <th class=" px-6 text-left text-xl searchable">date 2FA</th>
                <th class=" px-6 text-left text-xl searchable">name 2FA</th>
                <th class=" px-6 text-left text-xl searchable">Codes 2FA</th>
                
                <th class=" px-6 text-left text-xl searchable">Statue Backup</th>
                <th class=" px-6 text-left text-xl searchable">date Backup</th>
                <th class=" px-6 text-left text-xl searchable">Codes Backup</th>
                <th class=" px-6 text-left text-xl searchable">Number use</th>
                
                <th class=" px-6 text-left text-xl searchable">Statue alternate email</th>
                <th class=" px-6 text-left text-xl searchable">date alternate email</th>

                <th class=" px-6 text-left text-xl searchable">Statue Appeal</th>
                <th class=" px-6 text-left text-xl searchable">date action appeal</th>

                {% endif %}
                <th class=" px-6 text-left text-xl searchable">Statue Check gmail</th>
                <th class=" px-6 text-left text-xl searchable">Date check gmail</th>
                
            </tr>
        </thead>
        <tbody class="text-gray-700">
            {% for seed in seeds %} 
            <tr class="border-b border-gray-200 hover:bg-gray-50">
                
                
                <td class="sticky-id-column py-3 px-4 text-2xl seed-id">
                    <span data-field="order">{{ seed.order }}</span>
                </td>
                <td class="py-4 px-6 text-2xl tag">
                    <span onclick="showFullCodes(this)">
                        <span class="code-preview align-middle editable" data-field="tag">{{ seed.tag|slice:":4" }}...</span>  <!-- Show only the first 4 characters of email -->
                    </span>
                    <!-- Full code2FA, hidden by default -->
                    <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                        {{ seed.tag }}
                    </span>
                </td>
                
                {% if selected_role in roles %}
                <td class="py-4 px-6 text-2xl email">
                    <span onclick="showFullCodes(this)">
                        <span class="code-preview align-middle editable" data-field="email">{{ seed.email|slice:":4" }}...</span>  <!-- Show only the first 4 characters of email -->
                    </span>
                    <!-- Full code2FA, hidden by default -->
                    <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                        {{ seed.email }}
                    </span>
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span onclick="showFullCodes(this)">
                        <span class="code-preview align-middle editable" data-field="passwd">{{ seed.passwd|slice:":4" }}...</span>  <!-- Show only the first 4 characters of email -->
                    </span>
                    <!-- Full code2FA, hidden by default -->
                    <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                        {{ seed.passwd }}
                    </span>
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span onclick="showFullCodes(this)">
                        <span class="code-preview align-middle editable" data-field="rec">{{ seed.rec|slice:":4" }}...</span>  <!-- Show only the first 4 characters of email -->
                    </span>
                    <!-- Full code2FA, hidden by default -->
                    <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                        {{ seed.rec }}
                    </span>
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span onclick="showFullCodes(this)">
                        <span class="code-preview align-middle editable" data-field="new_pass">{{ seed.new_pass|slice:":4" }}...</span>  <!-- Show only the first 4 characters of email -->
                    </span>
                    <!-- Full code2FA, hidden by default -->
                    <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                        {{ seed.new_pass }}
                    </span>
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span onclick="showFullCodes(this)">
                        <span class="code-preview align-middle editable" data-field="new_rec">{{ seed.new_rec|slice:":4" }}...</span>  <!-- Show only the first 4 characters of email -->
                    </span>
                    <!-- Full code2FA, hidden by default -->
                    <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                        {{ seed.new_rec }}
                    </span>
                </td>
                {% endif %}
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_import">{{ seed.date_import|date:"Y-m-d" }}</span>
                   
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action">{{ seed.date_action|date:"Y-m-d" }}</span>
                 
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle editable" {% endif %} data-field="action">{{ seed.action }}</span>
                  
                </td>
                <!-- statue  -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue == "success" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue">{{ seed.statue }}</span>
                    {% elif  seed.statue == "failed" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue">{{ seed.statue }}</span>
                    {% elif  seed.statue == "NULL" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);" data-field="statue">{{ seed.statue }}</span>
                    {% else %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);" data-field="statue">{{ seed.statue }}</span>
                    {% endif %}
                 
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span data-field="id_proxy" class="align-middle editable">{{ seed.id_proxy }}</span>
                </td>

                <!-- ======================= -->

                <!-- statue connect -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_connect == "connected"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_connect">{{ seed.statue_connect }}</span>
                    {% elif seed.statue_connect == "blocked"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_connect">{{ seed.statue_connect }}</span>
                    {% elif seed.statue_connect == "verification"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);" data-field="statue_connect">{{ seed.statue_connect }}</span>
                    {% elif  seed.statue_connect == "NULL" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);" data-field="statue_connect">{{ seed.statue_connect }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_connect" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_connect }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_connect">{{ seed.date_action_connect|date:"Y-m-d" }}</span>
                  
                </td>
                {% if selected_role in roles %}
                <!-- action change pass -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_change_password == "Password Changed" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_change_password">{{ seed.statue_change_password }}</span>
                    {% elif  seed.statue_change_password == "Password Not Changed" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_change_password">{{ seed.statue_change_password }}</span>
                    {% elif  seed.statue_change_password == "NULL" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);" data-field="statue_change_password">{{ seed.statue_change_password }}</span>
                    {% else %}
                    <span {% if selected_role in roles %} class="align-middle editable badge-common" {% endif %} data-field="statue_change_password">{{ seed.statue_change_password }}</span>
                    {% endif %}
                  
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_password">{{ seed.date_action_password|date:"Y-m-d" }}</span>
                  
                </td>

                <!-- action change recovery -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_change_recovery == "RecoveryEmail Changed" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_change_recovery">{{ seed.statue_change_recovery }}</span>
                    {% elif  seed.statue_change_recovery == "RecoveryEmail Not Changed" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_change_recovery">{{ seed.statue_change_recovery }}</span>
                    {% elif  seed.statue_change_recovery == "NULL" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);" data-field="statue_change_recovery">{{ seed.statue_change_recovery }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_change_recovery" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_change_recovery }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_recovery">{{ seed.date_action_recovery|date:"Y-m-d" }}</span>
                    
                </td>

                <!-- action it was me -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_it_was_me == "success" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_it_was_me">{{ seed.statue_it_was_me }}</span>
                    {% elif  seed.statue_it_was_me == "failed" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_it_was_me">{{ seed.statue_it_was_me }}</span>
                    {% elif  seed.statue_it_was_me == "NULL" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);" data-field="statue_it_was_me">{{ seed.statue_it_was_me }}</span>
                    {% else %}
                    <span {% if selected_role in roles %} class="align-middle editable badge-common" {% endif %} data-field="statue_it_was_me">{{ seed.statue_it_was_me }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_it_was_me">{{ seed.date_action_it_was_me|date:"Y-m-d" }}</span>
                    
                </td>


                <!-- action delete device -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_delete_device == "Device Deleted" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_delete_device">{{ seed.statue_delete_device }}</span>
                    {% elif  seed.statue_delete_device == "Device Not Deleted" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_delete_device">{{ seed.statue_delete_device }}</span>
                    {% elif  seed.statue_delete_device == "NULL" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);" data-field="statue_delete_device">{{ seed.statue_delete_device }}</span>
                    {% else %}
                    <span {% if selected_role in roles %} class="align-middle editable badge-common" {% endif %} data-field="statue_delete_device">{{ seed.statue_delete_device }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_delete_device">{{ seed.date_action_delete_device|date:"Y-m-d" }}</span>
                    
                </td>

                <!-- action delete number -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_delete_phone == "success" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_delete_phone">{{ seed.statue_delete_phone }}</span>
                    {% elif  seed.statue_delete_phone == "failed" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_delete_phone">{{ seed.statue_delete_phone }}</span>
                    {% elif  seed.statue_delete_phone == "NULL" %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);" data-field="statue_delete_phone">{{ seed.statue_delete_phone }}</span>
                    {% else %}
                    <span {% if selected_role in roles %} class="align-middle editable badge-common" {% endif %} data-field="statue_delete_device">{{ seed.statue_delete_phone }}</span>
                    {% endif %}
                    
                </td>

                <!-- date_action_delete_phone -->
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_delete_phone">{{ seed.date_action_delete_phone|date:"Y-m-d" }}</span>
                    
                </td>

                <!-- service_phone -->
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle editable" {% endif %} data-field="service_phone">{{ seed.service_phone }}</span>
                 
                </td>

                <!-- phone_number -->
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle editable" {% endif %} data-field="phone_number">{{ seed.phone_number }}</span>
                 
                </td>

                <!-- =================  17/09/2024 by hamza ait youssef   =================== -->


                <!-- statue_authenticator -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_authenticator == "success"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_authenticator">{{ seed.statue_authenticator }}</span>
                    {% elif seed.statue_authenticator == "failed"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_authenticator">{{ seed.statue_authenticator }}</span>
                    {% elif seed.statue_authenticator == "NULL"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);; color: rgb(255, 255, 255);" data-field="statue_authenticator">{{ seed.statue_authenticator }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_authenticator" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_authenticator }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_authenticator">{{ seed.date_action_authenticator|date:"Y-m-d" }}</span>
                  
                </td>

                <!-- statue 2FA -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_2FA == "success"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_2FA">{{ seed.statue_2FA }}</span>
                    {% elif seed.statue_2FA == "failed"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_2FA">{{ seed.statue_2FA }}</span>
                    {% elif seed.statue_2FA == "NULL"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);; color: rgb(255, 255, 255);" data-field="statue_2FA">{{ seed.statue_2FA }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_2FA" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_2FA }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_2FA">{{ seed.date_action_2FA|date:"Y-m-d" }}</span>
                  
                </td>
                <!-- name 2FA -->
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle editable" {% endif %} data-field="name_2FA">{{ seed.name_2FA }}</span>
                    
                </td>

                <!-- code 2FA -->
                <td class="py-4 px-6 text-2xl">
                    <!-- Preview of code2FA -->
                    <span {% if selected_role in roles %} class="align-middle editable" {% endif %} onclick="showFullCodes(this)">
                        <span class="code-preview">{{ seed.code2FA|slice:":4" }}...</span>  <!-- Show only the first 4 characters of code2FA -->
                    </span>
                
                    <!-- Full code2FA, hidden by default -->
                    <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                        {{ seed.code2FA }}
                    </span>
                </td>
                

                <!-- statue backup -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_backup == "success"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_backup">{{ seed.statue_backup }}</span>
                    {% elif seed.statue_backup == "failed"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_backup">{{ seed.statue_backup }}</span>
                    {% elif seed.statue_backup == "NULL"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);; color: rgb(255, 255, 255);" data-field="statue_backup">{{ seed.statue_backup }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_backup" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_backup }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_backup">{{ seed.date_action_backup|date:"Y-m-d" }}</span>
                  
                </td>


                <!-- Code backup -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.codes_backup.exists %}
                        <span {% if selected_role in roles %} class="align-middle editable" {% endif %} onclick="showFullCodes(this)">
                            <span class="code-preview">{{ seed.codes_backup.first.code_backup|slice:":10" }}...</span>
                        </span>
                        
                        <!-- Full code list, hidden by default -->
                        <span class="full-codes" style="display:none;" tabindex="0" onblur="hideFullCodes(this)">
                            {% for code in seed.codes_backup.all %}
                            <span {% if selected_role in roles %} class="align-middle editable" {% endif %} data-field="code_backup_{{ forloop.counter }}">
                                {{ code.code_backup }}
                            </span>
                            <!-- hado bach ndir , o nsali b ] -->
                            <!-- {% if not forloop.last %} , {% endif %}
                            {% if forloop.last %}
                            
                            {% endif %} -->
                            {% endfor %}
                        </span>
                    {% else %}
                        <span>No codes</span> 
                    {% endif %}
                </td>




                <!-- number use -->
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle editable" {% endif %} data-field="number_use_2FA">{{ seed.number_use_2FA }}</span>
                  
                </td>

                <!-- statue alternate emails -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_alternate_email == "success"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_alternate_email">{{ seed.statue_alternate_email }}</span>
                    {% elif seed.statue_alternate_email == "failed"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_alternate_email">{{ seed.statue_alternate_email }}</span>
                    {% elif seed.statue_alternate_email == "NULL"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);; color: rgb(255, 255, 255);" data-field="statue_alternate_email">{{ seed.statue_alternate_email }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_alternate_email" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_alternate_email }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_alternate_email">{{ seed.date_action_alternate_email|date:"Y-m-d" }}</span>
                  
                </td>

                <!-- statue_appeal -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_appeal == "Appeal Sent"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_appeal">{{ seed.statue_appeal }}</span>
                    {% elif seed.statue_appeal == "Error in appeal"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_appeal">{{ seed.statue_appeal }}</span>
                    {% elif seed.statue_appeal == "NULL"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);; color: rgb(255, 255, 255);" data-field="statue_appeal">{{ seed.statue_appeal }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_authenticator" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_appeal }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_appeal">{{ seed.date_action_appeal|date:"Y-m-d" }}</span>
                  
                </td>

                
                {% endif %}
                <!-- statue_check_gmail -->
                <td class="py-4 px-6 text-2xl">
                    {% if seed.statue_check_gmail == "connected"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-success rounded-pill d-inline badge-common" {% else %} class="badge badge-success rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(187, 221, 187); color: rgb(68, 110, 58);" data-field="statue_check_gmail">{{ seed.statue_check_gmail }}</span>
                    {% elif seed.statue_check_gmail == "Not connected"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-danger rounded-pill d-inline badge-common" {% else %} class="badge badge-danger rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(221, 187, 187); color: rgb(110, 58, 68);" data-field="statue_check_gmail">{{ seed.statue_check_gmail }}</span>
                    {% elif seed.statue_check_gmail == "NULL"  %}
                    <span {% if selected_role in roles %} class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} style="background-color: rgb(116, 115, 115); color: rgb(255, 255, 255);; color: rgb(255, 255, 255);" data-field="statue_check_gmail">{{ seed.statue_check_gmail }}</span>
                    {% else %}
                    <span {% if selected_role in roles %}class="align-middle editable badge badge-warning rounded-pill d-inline badge-common" {% else %} class="badge badge-warning rounded-pill d-inline badge-common" {% endif %} data-field="statue_authenticator" style="background-color: rgb(245, 232, 188); color: rgb(90, 60, 31);">{{ seed.statue_check_gmail }}</span>
                    {% endif %}
                    
                </td>
                <td class="py-4 px-6 text-2xl">
                    <span {% if selected_role in roles %} class="align-middle" {% endif %} data-field="date_action_check_gmail">{{ seed.date_action_check_gmail|date:"Y-m-d" }}</span>
                  
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>




<br><br>

<!-- table count -->
{% if statue_count_items %}
<div class="overflow-x-auto">
    <table class="min-w-full bg-white shadow-md rounded-lg overflow-hidden" >
        <thead>
            <tr class="bg-gray-100 text-gray-700 uppercase leading-normal font-bold">
                <th scope="col" class="px-4 py-3 text-left text-xl font-medium text-gray-700 uppercase tracking-wider" id="ip">statue connect</th>
                <th scope="col" class="px-4 py-3 text-left text-xl font-medium text-gray-700 uppercase tracking-wider">Count</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for proxy, count in statue_count_items %}
            <tr class="ip-count-row" data-ip="{{ proxy }}">
                <td class="px-4 py-3 whitespace-nowrap text-2xl">{{ proxy }}</td>
                <td class="px-4 py-3 whitespace-nowrap  text-2xl">{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
</div>
{% endif %}

<br><br>

  <div>

<!-- pagination -->
<div class="clearfix"> 
    <div class="d-flex justify-content-between align-items-center mt-2"> 
        <!-- Align this div to the far left -->
        <div class="hint-text">Showing <b>{{ seeds.start_index }}</b> to <b>{{ seeds.end_index }}</b> of <b>{{ seeds.paginator.count }}</b> entries</div> 
        
        <!-- Align this ul to the center -->
        <ul class="pagination mb-0 custom-pagination" id="pagination" style="margin: 0 auto;"> 
            <!-- Pagination links will be dynamically generated here -->
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 rounded-l-lg bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">Previous</a>
            </li>
            <li class="page-item active">
                <a class="page-link text-xl px-3 py-2 bg-blue-600 text-white rounded" href="#">1</a>
            </li>
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">2</a>
            </li>
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">3</a>
            </li>
            <li class="page-item">
                <a class="page-link text-xl px-3 py-2 rounded-r-lg bg-gray-100 text-gray-600 hover:bg-blue-600 hover:text-white transition duration-300" href="#">Next</a>
            </li>
        </ul> 

        <!-- Align this form to the far right -->
        <form id="columnsForm" method="get" class="d-flex align-items-center ml-3 mt-7"> 
            {% for key, value in request.GET.items %} 
                {% if key != 'columns' %} 
                    <input type="hidden" name="{{ key }}" value="{{ value }}"> 
                {% endif %} 
            {% endfor %} 
            <select class="form-select h-12 text-xl px-3 py-2 border border-gray-300 rounded-lg ml-2" name="columns" id="columns" style="width: 200px;" onchange="changeColumnsPerPage()"> 
                <option value="" id="defaultOption" class="text-xl px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider">{{ columns }} lments par page </option> 
                <option value="2" {% if columns == 2 %} selected {% endif %}>2</option> 
                <option value="4" {% if columns == 4 %} selected {% endif %}>4</option> 
                <option value="10" {% if columns == 10 %} selected {% endif %}>10</option> 
                <option value="50" {% if columns == 50 %} selected {% endif %}>50</option> 
                <option value="100" {% if columns == 100 %} selected {% endif %}>100</option> 
                <option value="1000" {% if columns == 1000 %} selected {% endif %}>1000</option> 
                <option value="{{ seeds.paginator.count }}" {% if columns == seeds.paginator.count %} selected {% endif %}>all</option>

            </select> 
        </form> 
    </div> 
</div>


<!-- script for pagination -->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const totalPages = parseInt("{{ seeds.paginator.num_pages|default:0 }}");
        const currentPage = parseInt("{{ seeds.number|default:1 }}");
        const columnsPerPage = parseInt("{{ columns|default:10 }}");
        const urlParams = new URLSearchParams(window.location.search);

        function createPageLink(page, text, isActive = false) {
            const li = document.createElement('li');
            li.className = `page-item custom-page-item ${isActive ? 'active' : ''}`;
            const a = document.createElement('a');
            a.className = 'page-link custom-page-link';
            a.href = `?${urlParams.toString()}&page=${page}&columns=${columnsPerPage}`;
            a.textContent = text;
            li.appendChild(a);
            return li;
        }

        function updatePagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            

            if (currentPage > 4 ) {
                if (currentPage != 5){
                pagination.appendChild(createPageLink(1, '1'));
                pagination.appendChild(createPageLink(2, '2'));
               
                pagination.appendChild(createPageLink(3, '...'));
            }
            }
            if (currentPage == 5) {
                pagination.appendChild(createPageLink(1, '1'));
                pagination.appendChild(createPageLink(2, '2'));
                // pagination.appendChild(createPageLink(3, '3'));
                // pagination.appendChild(createPageLink(4, '4'));
                pagination.appendChild(createPageLink(5, '...'));
            }
            if (currentPage == 4) {
                pagination.appendChild(createPageLink(1, '1'));
               
            }
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                pagination.appendChild(createPageLink(i, i, i === currentPage));
            }

            if (currentPage < totalPages - 3) {
                pagination.appendChild(createPageLink(totalPages - 2, '...'));
                
                pagination.appendChild(createPageLink(totalPages - 1, totalPages - 1));
                pagination.appendChild(createPageLink(totalPages, totalPages));
            }

           
        }

        updatePagination();
    });

    
</script>

<script>  
    function changeColumnsPerPage() {  
        var select = document.getElementById("columns");  
        var selectedOption = select.options[select.selectedIndex].value;  
        var defaultOption = document.getElementById("defaultOption");  
        defaultOption.textContent = select.options[select.selectedIndex].textContent;  
        // Mettre  jour la valeur de la colonne dans la session  
        fetch('?columns=' + selectedOption, { method: 'GET' });  
        // Soumettre le formulaire lorsque la slection change  
        document.getElementById("columnsForm").submit();  
    }  
  
    function exportData() {  
        var select = document.getElementById("export_format_select");  
        var selectedFormat = select.options[select.selectedIndex].value;  
        if (selectedFormat) {  
            // Soumettre le formulaire d'exportation  
            document.getElementById("exportForm").submit();  
        } else {  
            alert("Veuillez slectionner un format d'exportation.");  
        }  
    }  
</script>





<div id="csrf-token" data-csrf="{{ csrf_token }}"></div>


<!-- // Modifier les donnes du tableau  -->
<script> 



// JavaScript for first form (1)


(function() {
    // Function to store selected values in local storage
    function storeSelectedValues() {
        var entity = document.getElementById('id_entity1').value;
        var rdp = document.getElementById('id_rdp1').value;
        var session = document.getElementById('id_sess1').value;
        localStorage.setItem('selectedEntity1', entity);
        localStorage.setItem('selectedRdp1', rdp);
        localStorage.setItem('selectedSession1', session);
    }

    // Function to populate RDP dropdown
    function populateRdpDropdown(data) {
        var select = document.getElementById('id_rdp1');
        var previousValue = select.value; // Save previous value
        select.innerHTML = '';

        var emptyOption = document.createElement('option');
        emptyOption.value = '';
        emptyOption.textContent = 'Select RDP';
        select.appendChild(emptyOption);

        data.forEach(function(rdp) {
            var option = document.createElement('option');
            option.value = rdp.id_rdp;
            option.textContent = rdp.nom;
            select.appendChild(option);
        });

        // Restore previous value if it exists
        if (previousValue) {
            select.value = previousValue;
        }
    }

    // Function to populate Session dropdown
    function populateSessionDropdown(data) {
        var select = document.getElementById('id_sess1');
        var previousValue = select.value; // Save previous value
        select.innerHTML = '';

        var emptyOption = document.createElement('option');
        emptyOption.value = '';
        emptyOption.textContent = 'Select Session';
        select.appendChild(emptyOption);

        data.forEach(function(session) {
            var option = document.createElement('option');
            option.value = session.id_sess;
            option.textContent = session.name;
            select.appendChild(option);
        });

        // Restore previous value if it exists
        if (previousValue) {
            select.value = previousValue;
        }
    }

    // Event for entity dropdown change
    document.getElementById('id_entity1').addEventListener('change', function() {
        var entity_id = this.value;
        fetch('/fetch_rdp/?entity_id=' + entity_id)
            .then(response => response.json())
            .then(data => {
                populateRdpDropdown(data);
            });
    });

    // Event for RDP dropdown change
    document.getElementById('id_rdp1').addEventListener('change', function() {
        var rdp_id = this.value;
        fetch('/fetch_session/?rdp_id=' + rdp_id)
            .then(response => response.json())
            .then(data => {
                populateSessionDropdown(data);
            });
    });

    // Store selected values before form submission
    document.getElementById('import').addEventListener('submit', function() {
        storeSelectedValues();
    });

    // Populate dropdowns with previously selected values on page load
    document.addEventListener('DOMContentLoaded', function() {
        var entityDropdown = document.getElementById('id_entity1');
        var rdpDropdown = document.getElementById('id_rdp1');
        var sessionDropdown = document.getElementById('id_sess1');

        var selectedEntityId = localStorage.getItem('selectedEntity1');
        var selectedRdpId = localStorage.getItem('selectedRdp1');
        var selectedSessionId = localStorage.getItem('selectedSession1');

        // Populate entity dropdown with the previously selected value
        if (selectedEntityId) {
            entityDropdown.value = selectedEntityId;
            // If an entity is selected, also populate the corresponding RDP dropdown
            fetch('/fetch_rdp/?entity_id=' + selectedEntityId)
                .then(response => response.json())
                .then(data => {
                    populateRdpDropdown(data);
                    // Set the previously selected RDP value
                    if (selectedRdpId) {
                        rdpDropdown.value = selectedRdpId;
                        // If an RDP is selected, also populate the corresponding Session dropdown
                        fetch('/fetch_session/?rdp_id=' + selectedRdpId)
                            .then(response => response.json())
                            .then(data => {
                                populateSessionDropdown(data);
                                // Set the previously selected Session value
                                if (selectedSessionId) {
                                    sessionDropdown.value = selectedSessionId;
                                }
                            });
                    }
                });
        }
    });
})();



// end JavaScript for first form (1)


// JavaScript for filters - second form (2)
(function() {
// Fonction pour extraire les paramtres de l'URL 
function getUrlParams(url) { 
        var params = {}; 
        url.slice(url.indexOf('?') + 1).split('&').forEach(function(param) { 
            var paramTuple = param.split('='); 
            params[paramTuple[0]] = decodeURIComponent(paramTuple[1]); 
        }); 
        return params; 
    } 
 
    // Variables pour stocker les valeurs slectionnes prcdemment 
    var urlParams = getUrlParams(window.location.href); 
    // var selectedEntityId = urlParams['id_entity'] || ''; 
    // var selectedRdpId = urlParams['id_rdp'] || ''; 
    // var selectedSessionId = urlParams['id_sess'] || ''; 
    var selectedProxyId = urlParams['id_proxy'] || '';
    var selectedStatue = urlParams['statue'] || '';
    var selectedDateActionGte = urlParams['date_action__gte'] || '';
    var selectedDateActionLte = urlParams['date_action__lte'] || '';
 
    // Fonction pour remplir le menu droulant RDP avec les valeurs pour une entit donne 
    function getRdpsForEntity(entityId) { 
        fetch('/fetch_rdp?entity_id=' + entityId) 
            .then(response => response.json()) 
            .then(data => { 
                populateRdpDropdown(data); 
                // Stockez l'ID de l'entit slectionne 
                selectedEntityId = entityId; 
            }); 
    } 
 
    // Fonction pour remplir le menu droulant Session avec les valeurs pour un RDP donn 
    function getSessionsForRdp(rdpId) { 
        fetch('/fetch_session?rdp_id=' + rdpId) 
            .then(response => response.json()) 
            .then(data => { 
                populateSessionDropdown(data); 
                // Stockez l'ID du RDP slectionn 
                selectedRdpId = rdpId; 
            }); 
    } 
 
    // Remplir les menus droulants avec les valeurs slectionnes prcdemment 
    document.addEventListener('DOMContentLoaded', function() { 
        var entityDropdown = document.getElementById('id_entity'); 
        var rdpDropdown = document.getElementById('id_rdp'); 
        var sessionDropdown = document.getElementById('id_sess'); 
        var proxyDropdown = document.getElementById('id_proxy');
    var statueDropdown = document.getElementById('statue');
    var dateActionGteInput = document.querySelector('input[name="date_action__gte"]');
    var dateActionLteInput = document.querySelector('input[name="date_action__lte"]'); 
        

        // Populate proxy dropdown
    proxyDropdown.value = selectedProxyId;

// Populate statue dropdown
statueDropdown.value = selectedStatue;

// Populate date action from field
dateActionGteInput.value = selectedDateActionGte;

// Populate date action to field
dateActionLteInput.value = selectedDateActionLte;
        // Remplir le menu droulant d'entit avec la valeur slectionne prcdemment 
        if (selectedEntityId) { 
            entityDropdown.value = selectedEntityId; 
            // Si une entit est slectionne, remplir galement le menu droulant RDP correspondant 
            if (selectedEntityId) { 
                getRdpsForEntity(selectedEntityId); 
            } 
        } 
 
        // Remplir le menu droulant RDP avec la valeur slectionne prcdemment 
        if (selectedRdpId) { 
            rdpDropdown.value = selectedRdpId; 
            // Si un RDP est slectionn, remplir galement le menu droulant Session correspondant 
            if (selectedRdpId) { 
                getSessionsForRdp(selectedRdpId); 
            } 
        } 
        
 
        // Remplir le menu droulant Session avec la valeur slectionne prcdemment 
        if (selectedSessionId) { 
            sessionDropdown.value = selectedSessionId; 
        } 
    }); 
 
    // Function  RDP dropdown 
    function populateRdpDropdown(data) { 
        var select = document.getElementById('id_rdp'); 
        var previousValue = select.value; // Sauvegarde de la valeur prcdente 
        select.innerHTML = ''; 
         
        var emptyOption = document.createElement('option'); 
        emptyOption.value = ''; 
        emptyOption.textContent = 'Select RDP'; 
        select.appendChild(emptyOption); 
         
        data.forEach(function(rdp) { 
            var option = document.createElement('option'); 
            option.value = rdp.id_rdp; 
            option.textContent = rdp.nom; 
            select.appendChild(option); 
        }); 
 
        // Restauration de la valeur prcdente si elle existe 
        if (previousValue) { 
            select.value = previousValue; 
        } 
    } 
 
    // Function  Session dropdown 
    function populateSessionDropdown(data) { 
        var select = document.getElementById('id_sess'); 
        var previousValue = select.value; // Sauvegarde de la valeur prcdente 
 
        select.innerHTML = ''; 
         
        var emptyOption = document.createElement('option'); 
        emptyOption.value = '';
        emptyOption.textContent = 'Select Session'; 
        select.appendChild(emptyOption); 
         
        data.forEach(function(session) { 
            var option = document.createElement('option'); 
            option.value = session.id_sess; 
            option.textContent = session.name; 
            select.appendChild(option); 
        }); 
         // Restauration de la valeur prcdente si elle existe 
         if (previousValue) { 
            select.value = previousValue; 
        } 
    } 
 
    // Event  for entity dropdown change 
    document.getElementById('id_entity').addEventListener('change', function() { 
        var entity_id = this.value; 
        fetch('/fetch_rdp/?entity_id=' + entity_id) 
            .then(response => response.json()) 
            .then(data => { 
                populateRdpDropdown(data); 
            }); 
    }); 
 
    // Event  for RDP dropdown change 
    document.getElementById('id_rdp').addEventListener('change', function() { 
        var rdp_id = this.value; 
        fetch('/fetch_session/?rdp_id=' + rdp_id) 
            .then(response => response.json()) 
            .then(data => { 
                populateSessionDropdown(data); 
                // Stockez l'ID du RDP slectionn 
                selectedRdpId = rdp_id; 
            }); 
    }); 
})();
// end JavaScript for second form (2)
</script>


<!-- for toggle divs of filter   -->
<script>
$(document).ready(function() {
    let lastClicked = '';




    
    // Function to toggle filter div
    function toggleFilterDiv() {
        $('#filterDiv').toggle();
        if ($('#filterDiv').is(':visible')) {
            localStorage.setItem('filterVisible', 'true');
        } else {
            localStorage.setItem('filterVisible', 'false');
        }
    }

    // Function to show filter div
    function showFilterDiv() {
        $('#filterDiv').show();
        localStorage.setItem('filterVisible', 'true');
    }

    // Function to hide filter div
    function hideFilterDiv() {
        $('#filterDiv').hide();
        localStorage.setItem('filterVisible', 'false');
    }

    // Function to set active link style
    function setActiveLink(linkName) {
        $('#filterLink, #uploadLink, #downloadLink, #specificdataLink').removeClass('active text-blue-600 bg-gray-100 dark:bg-gray-800 dark:text-blue-500 no-underline hover:no-underline');
        $('#' + linkName + 'Link').addClass('active text-blue-600 bg-gray-100 dark:bg-gray-800 dark:text-blue-500 no-underline hover:no-underline');
    }

    // Function to adjust the width of the select dropdown
    function adjustSelectWidth(isHalfWidth) {
        const selectContainer = $('.select2-container--default');

        if (isHalfWidth) {
            selectContainer.css('width', '100%');
        } else {
            selectContainer.css('min-width', '100%');
        }
    }

    // Event listeners for tab links
    $('#filterLink').click(function(event) {
        event.preventDefault();
        if (lastClicked === 'filter') {
            toggleFilterDiv();
        } else {
            showFilterDiv();
        }
        setActiveLink('filter');
        $('#uploadDiv, #downloadDiv, #specificdataDiv').hide();
        adjustSelectWidth(false); // Set to full width when filter is clicked
        lastClicked = 'filter';
        localStorage.setItem('lastClicked', 'filter');
    });

    $('#uploadLink').click(function(event) {
        event.preventDefault();
        $('#uploadDiv').toggle();
        $('#downloadDiv, #specificdataDiv').hide();
        if ($('#uploadDiv').is(':visible')) {
            hideFilterDiv();
            setActiveLink('upload');
            lastClicked = 'upload';
            localStorage.setItem('lastClicked', 'upload');
        } 
    });

    $('#downloadLink').click(function(event) {
        event.preventDefault();
        $('#downloadDiv').toggle();
        $('#uploadDiv, #specificdataDiv').hide();
        if ($('#downloadDiv').is(':visible')) {
            showFilterDiv();
            setActiveLink('download');
            adjustSelectWidth(true); // Set to half width when download is clicked
            lastClicked = 'download';
            localStorage.setItem('lastClicked', 'download');
        } else {
            hideFilterDiv();
            setActiveLink('download');
            adjustSelectWidth(true);
            lastClicked = 'download';
            localStorage.setItem('lastClicked', 'download');
        }
    });

    // New: Event listener for specific data link
    $('#specificdataLink').click(function(event) {
        event.preventDefault();
        $('#specificdataDiv').toggle();
        $('#uploadDiv, #downloadDiv').hide();
        if ($('#specificdataDiv').is(':visible')) {
            hideFilterDiv();
            setActiveLink('specificdata');
            lastClicked = 'specificdata';
            localStorage.setItem('lastClicked', 'specificdata');
        }
    });

    // Initial setup on page load
    if (localStorage.getItem('filterVisible') !== 'false') {
        $('#filterDiv').show();
    } else {
        $('#filterDiv').hide();
    }

    const activeTab = localStorage.getItem('lastClicked');
    if (activeTab === 'upload') {
        $('#uploadDiv').show();
        $('#downloadDiv, #specificdataDiv').hide();
    } else if (activeTab === 'download') {
        $('#downloadDiv').show();
        $('#uploadDiv, #specificdataDiv').hide();
    } else if (activeTab === 'specificdata') {
        $('#specificdataDiv').show();
        $('#uploadDiv, #downloadDiv').hide();
    } else {
        $('#uploadDiv, #downloadDiv, #specificdataDiv').hide();
    }

    if (activeTab) {
        setActiveLink(activeTab);
        lastClicked = activeTab;
    }
});

</script>


<!-- check YYYY-MM-DD format -->
<script>

    function validateDateFormat(dateString) {
      // Regular expression to check YYYY-MM-DD format
      const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
    
      // Check if the string matches the expected format
      return dateRegex.test(dateString);
    }
    
    function submitForm() {
      const dateFromInput = document.querySelector('input[name="date_action__gte"]');
      const dateToInput = document.querySelector('input[name="date_action__lte"]');
    
      // Validate start date format
      if (dateFromInput.value && !validateDateFormat(dateFromInput.value)) {
        toastr.warning('Le format de la date de dbut est incorrect. Veuillez entrer une date au format YYYY-MM-DD.');
        return false;
      }
    
      // Validate end date format
      if (dateToInput.value && !validateDateFormat(dateToInput.value)) {
        toastr.warning('Le format de la date de fin est incorrect. Veuillez entrer une date au format YYYY-MM-DD.');
        return false;
      }
    
      // If formats are correct, submit the form
      return true;
    }
    
</script>


<!-- show full backup codes  -->
<script>
    function showFullCodes(element) {
        let preview = element.querySelector('.code-preview');
        let fullCodes = element.nextElementSibling;

        preview.style.display = 'none';  // Hide the preview
        fullCodes.style.display = 'inline';  // Show the full codes
        fullCodes.focus();  // Focus the element to capture the blur event
    }

    function hideFullCodes(element) {
        let fullCodes = element;
        let preview = fullCodes.previousElementSibling.querySelector('.code-preview');

        if (preview) {
            fullCodes.style.display = 'none';  // Hide the full codes
            preview.style.display = 'inline';  // Show the preview again
        }
    }
</script>


<!--  Copy id seeds and tags to clipboard  -->
<script>
    function copyColumnContent(column) {
        let textToCopy = '';
        const rows = document.querySelectorAll('tbody tr');

        rows.forEach(row => {
            let cellContent = '';
            if (column === 'seed-id') {
                const seedCell = row.querySelector('.seed-id span'); 
                if (seedCell) {
                    cellContent = seedCell.textContent; 
                }
            } else if (column === 'tag') {
                const tagCell = row.querySelector('.tag span'); 
                if (tagCell) {
                    cellContent = tagCell.textContent; 
                }
            }
             else if (column === 'email') {
                const emailCell = row.querySelector('.email span'); 
                if (emailCell) {
                    cellContent = emailCell.textContent; 
                }
            }
            if (cellContent) { 
                textToCopy += cellContent + '\n';
            }
        });

        // Copy to clipboard
        if (textToCopy) {
            navigator.clipboard.writeText(textToCopy.trim()).then(() => {
                toastr.success('Copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        } else {
            toastr.warning('No content to copy.');
            
        }
    }
</script>


<!-- specificIdsInput  -->
<script>
    $(document).ready(function() {
        $('#filterByIdButton').click(function(event) {
            event.preventDefault();
            const specificIds = $('#specificIdsInput').val().split('\n').map(id => id.trim()).filter(id => id !== "");
            
            // Send the request via AJAX
            $.ajax({
                url: "{% url 'seeds' %}",  
                type: "GET",
                data: {
                    specific_ids: specificIds.join("\n")  // Send IDs as a newline-separated string
                },
                success: function(response) {
                    // Replace the table content with the filtered results
                    $('#dataTable tbody').html(response);
                }
            });
        });
    });
    
    
    </script>
    
<script>
    $(document).ready(function() {
        $('.hamza').select2();
    });
</script>

{% endblock %}


